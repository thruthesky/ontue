<section>


  <div class="options" *ngIf=" showOptions ">

    <ion-grid *ngIf=" data['past'] ">
      <ion-row>
        <ion-col>
          <ion-item>
            <ion-label>Begin Date</ion-label>
            <ion-datetime name="date_begin" displayFormat="MM/DD/YYYY" pickerFormat="YYYYMMDD" [(ngModel)]="date_begin" (ngModelChange)="onChangeSearchOption()"></ion-datetime>
          </ion-item>
        </ion-col>
        <ion-col>

          <ion-item>
            <ion-label>End Date</ion-label>
            <ion-datetime name="date_end" displayFormat="MM/DD/YYYY" pickerFormat="YYYYMMDD" [(ngModel)]="date_end" (ngModelChange)="onChangeSearchOption()"></ion-datetime>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>

    <ion-list *ngIf=" my_teachers ">
      <ion-item>
        <ion-label class="blue">{{'SELECT TEACHER'|translate}}</ion-label>
        <ion-select [(ngModel)]="show_teacher" (ionChange)="onChangeSearchOption()" okText="{{ 'OK' | translate }}" cancelText="{{ 'CANCEL' | translate }}"
          [selectOptions]="{ title: a.i18n.SELECT_TEACHER_TITLE }">
          <ion-option *ngFor="let teacher of my_teachers" [value]=" teacher.idx ">{{ teacher.name }}</ion-option>
          <ion-option [value]="0">{{ "ALL TEACHER" | translate }}</ion-option>
        </ion-select>
      </ion-item>
    </ion-list>

    <ion-list *ngIf=" data['past'] ">
      <ion-item>
        <ion-checkbox [(ngModel)]="show_refund_in_progress" color="vibrant" (ionChange)="onChangeSearchOption()"></ion-checkbox>
        <ion-label>Display sessions in progress of Refund</ion-label>
      </ion-item>
      <ion-item>
        <ion-checkbox [(ngModel)]="show_refunded" color="vibrant" (ionChange)="onChangeSearchOption()"></ion-checkbox>
        <ion-label>Display refunded sessions</ion-label>
      </ion-item>
    </ion-list>



    <hr>


    <button ion-button (click)="onClickSearch()">
      SEARCH
    </button>
    <hr>


  </div>
  <!--/options-->


  {{ a.user.name }} You are {{ a.userType }}! , My Points:
  <span *ngIf=" ! a.inLoadingMyPoint ">{{ my_point }}</span>
  <ion-spinner *ngIf=" a.inLoadingMyPoint "></ion-spinner>


  <section class="list-information" *ngIf=" re ">
    Total: {{ re.total }} sessions.
    <br> Searched: {{ re.books.length }} sessions.
    <br> Total Point: 1234567 points.
    <br> Refunded: xxx sessions.
    <br> In process of refund: xxx sessions.
    <br>
  </section>

  <table class="books" *ngIf=" books.length ">
    <tr>
        <td>Teacher</td>
      <td>Class No.</td>
      <td>Date</td>
      <td>Time</td>
      <td>Student</td>
      <td>Point</td>
      <td></td>

    </tr>

    <tr *ngFor="let book of books; let i = index;">
        <td>
          <div class="pointer" (click)=" a.open('schedule-table', { ID: book.idx_teacher })">
            <img class="d-block size-8" src="{{ book.teacher_photoURL }}">
          {{book.teacher_name}}
        </div>
        </td>
      <td>{{book.idx}}</td>
      <td>{{book.date_display}}</td>
      <td>{{book.class_begin_display}}
        <br>{{book.duration}}mins</td>
      <td>{{book.student_name}}</td>
      <td>{{book.point}}</td>
      <td>
        <div class="past" *ngIf=" book.past ">
          <div class="teacher" *ngIf=" a.lms.getUserType() == 'teacher' ">
            <button ion-button (click)=" a.open('evaluate', {idx: book.idx}) ">Evaluate</button>

            <ng-container *ngIf=" rejected( book ) ">
              <span class="alert alert-warning">Point Refuned Request Rejected</span>
            </ng-container>

            <ng-container *ngIf=" ! rejected( book ) ">
              <span class="alert alert-info" *ngIf=" refunded(book) ">Refunded</span>
              <ng-container *ngIf=" ! refunded( book ) ">
                <button ion-button (click)=" onClickRefund( book ) " *ngIf="!refund_request(book)">Refund</button>
                <button ion-button color="danger" (click)=" onClickRefund( book ) " *ngIf="refund_request(book)">Accept Refund Request</button>
                <button ion-button color="danger" (click)=" onClickRejectRefundRequest( book ) " *ngIf="refund_request(book)">Reject Refund Request</button>
              </ng-container>
            </ng-container>

          </div>

          <div class="student" *ngIf=" a.lms.getUserType() == 'student' ">

            <button ion-button (click)=" onClickEvaluateView(book.idx)">Evaluation</button>


            <ng-container *ngIf=" rejected( book ) ">
              <span class="alert alert-warning">Point Refuned Request Rejected</span>
            </ng-container>

            <ng-container *ngIf=" ! rejected( book ) ">
              <span class="alert alert-info" *ngIf=" refunded(book) ">Refunded</span>
              <ng-container *ngIf=" ! refunded( book ) ">
                <ng-container *ngIf=" book.refund_request_at > 0 ">
                  <button ion-button color="light" (click)=" onClickCancelRefundRequest( book )">Cancel Refund Request</button>
                </ng-container>
                <ng-container *ngIf=" book.refund_request_at == 0 ">
                  <button ion-button (click)=" onClickRefundRequest( book )">Request Refund</button>
                </ng-container>
              </ng-container>
            </ng-container>

          </div>

        </div>
        <ng-container *ngIf=" ! book.past ">
          <button ion-button (click)="onClickCancel( book )" *ngIf=" ! book.process ">Cancel</button>
          <ion-spinner *ngIf=" book.process "></ion-spinner>
        </ng-container>
      </td>
    </tr>
  </table>
</section>
